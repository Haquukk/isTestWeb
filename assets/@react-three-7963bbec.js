import{_ as fe}from"./@babel-34ca84e8.js";import{r as P}from"./react-ccb5ed75.js";import{L as de,T as nt,R as rt,U as ot,s as Ie,B as it,M as at,C as Fe,a as st,O as lt,P as ct,S as Oe,b as pe,V as G,c as ze,W as ut,d as ft,e as dt,f as pt,g as vt,h as mt,N as ht,A as gt,i as yt,j as wt,D as ie,k as _t,l as bt,m as Pt,n as Ct,o as ke,p as Et,q as Mt}from"./three-0c2681a8.js";import{u as St}from"./react-use-measure-43afca94.js";import{F as Ot,u as kt}from"./its-fine-b0cabe29.js";import{R as xt,c as X}from"./react-reconciler-c5549ab8.js";import"./react-dom-6efbe13b.js";import{c as Ne}from"./zustand-36b18702.js";import{G as Ee,D as Rt,M as ve,O as Tt}from"./three-stdlib-f12fc2d7.js";import{m as jt}from"./react-merge-refs-239dbb3c.js";import{s as Lt,p as At,c as Dt}from"./suspend-react-00b64780.js";var ce={},It={get exports(){return ce},set exports(e){ce=e}},He={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(y,S){var M=y.length;y.push(S);e:for(;0<M;){var O=M-1>>>1,k=y[O];if(0<c(k,S))y[O]=S,y[M]=k,M=O;else break e}}function o(y){return y.length===0?null:y[0]}function i(y){if(y.length===0)return null;var S=y[0],M=y.pop();if(M!==S){y[0]=M;e:for(var O=0,k=y.length,H=k>>>1;O<H;){var I=2*(O+1)-1,K=y[I],B=I+1,oe=y[B];if(0>c(K,M))B<k&&0>c(oe,K)?(y[O]=oe,y[B]=M,O=B):(y[O]=K,y[I]=M,O=I);else if(B<k&&0>c(oe,M))y[O]=oe,y[B]=M,O=B;else break e}}return S}function c(y,S){var M=y.sortIndex-S.sortIndex;return M!==0?M:y.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var g=Date,v=g.now();e.unstable_now=function(){return g.now()-v}}var a=[],m=[],n=1,r=null,l=3,f=!1,p=!1,_=!1,h=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(y){for(var S=o(m);S!==null;){if(S.callback===null)i(m);else if(S.startTime<=y)i(m),S.sortIndex=S.expirationTime,t(a,S);else break;S=o(m)}}function w(y){if(_=!1,b(y),!p)if(o(a)!==null)p=!0,q(E);else{var S=o(m);S!==null&&z(w,S.startTime-y)}}function E(y,S){p=!1,_&&(_=!1,s(T),T=-1),f=!0;var M=l;try{for(b(S),r=o(a);r!==null&&(!(r.expirationTime>S)||y&&!C());){var O=r.callback;if(typeof O=="function"){r.callback=null,l=r.priorityLevel;var k=O(r.expirationTime<=S);S=e.unstable_now(),typeof k=="function"?r.callback=k:r===o(a)&&i(a),b(S)}else i(a);r=o(a)}if(r!==null)var H=!0;else{var I=o(m);I!==null&&z(w,I.startTime-S),H=!1}return H}finally{r=null,l=M,f=!1}}var R=!1,x=null,T=-1,L=5,A=-1;function C(){return!(e.unstable_now()-A<L)}function j(){if(x!==null){var y=e.unstable_now();A=y;var S=!0;try{S=x(!0,y)}finally{S?F():(R=!1,x=null)}}else R=!1}var F;if(typeof u=="function")F=function(){u(j)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,U=W.port2;W.port1.onmessage=j,F=function(){U.postMessage(null)}}else F=function(){h(j,0)};function q(y){x=y,R||(R=!0,F())}function z(y,S){T=h(function(){y(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(y){y.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,q(E))},e.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<y?Math.floor(1e3/y):5},e.unstable_getCurrentPriorityLevel=function(){return l},e.unstable_getFirstCallbackNode=function(){return o(a)},e.unstable_next=function(y){switch(l){case 1:case 2:case 3:var S=3;break;default:S=l}var M=l;l=S;try{return y()}finally{l=M}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(y,S){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var M=l;l=y;try{return S()}finally{l=M}},e.unstable_scheduleCallback=function(y,S,M){var O=e.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?O+M:O):M=O,y){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=M+k,y={id:n++,callback:S,priorityLevel:y,startTime:M,expirationTime:k,sortIndex:-1},M>O?(y.sortIndex=M,t(m,y),o(a)===null&&y===o(m)&&(_?(s(T),T=-1):_=!0,z(w,M-O))):(y.sortIndex=k,t(a,y),p||f||(p=!0,q(E))),y},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(y){var S=l;return function(){var M=l;l=S;try{return y.apply(this,arguments)}finally{l=M}}}})(He);(function(e){e.exports=He})(It);const Me={},Ft=e=>void Object.assign(Me,e);function zt(e,t){function o(n,{args:r=[],attach:l,...f},p){let _=`${n[0].toUpperCase()}${n.slice(1)}`,h;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=f.object;h=$(s,{type:n,root:p,attach:l,primitive:!0})}else{const s=Me[_];if(!s)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");h=$(new s(...r),{type:n,root:p,attach:l,memoizedProps:{args:r}})}return h.__r3f.attach===void 0&&(h instanceof it?h.__r3f.attach="geometry":h instanceof at&&(h.__r3f.attach="material")),_!=="inject"&&he(h,f),h}function i(n,r){let l=!1;if(r){var f,p;(f=r.__r3f)!=null&&f.attach?me(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),l=!0),l||(p=n.__r3f)==null||p.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=n,Ce(r),Z(r)}}function c(n,r,l){let f=!1;if(r){var p,_;if((p=r.__r3f)!=null&&p.attach)me(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const h=n.children.filter(u=>u!==r),s=h.indexOf(l);n.children=[...h.slice(0,s),r,...h.slice(s)],f=!0}f||(_=n.__r3f)==null||_.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=n,Ce(r),Z(r)}}function d(n,r,l=!1){n&&[...n].forEach(f=>g(r,f,l))}function g(n,r,l){if(r){var f,p,_;if(r.__r3f&&(r.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(w=>w!==r)),(p=r.__r3f)!=null&&p.attach)Le(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var h;n.remove(r),(h=r.__r3f)!=null&&h.root&&Vt(r.__r3f.root,r)}const u=(_=r.__r3f)==null?void 0:_.primitive,b=l===void 0?r.dispose!==null&&!u:l;if(!u){var s;d((s=r.__r3f)==null?void 0:s.objects,r,b),d(r.children,r,b)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,u||delete r.__r3f),b&&r.dispose&&r.type!=="Scene"&&ce.unstable_scheduleCallback(ce.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),Z(n)}}function v(n,r,l,f){var p;const _=(p=n.__r3f)==null?void 0:p.parent;if(!_)return;const h=o(r,l,n.__r3f.root);if(n.children){for(const s of n.children)s.__r3f&&i(h,s);n.children=n.children.filter(s=>!s.__r3f)}n.__r3f.objects.forEach(s=>i(h,s)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||g(_,n),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),i(_,h),h.raycast&&h.__r3f.eventCount&&h.__r3f.root.getState().internal.interaction.push(h),[f,f.alternate].forEach(s=>{s!==null&&(s.stateNode=h,s.ref&&(typeof s.ref=="function"?s.ref(h):s.ref.current=h))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:xt({createInstance:o,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const l=n.getState().scene;l.__r3f&&(l.__r3f.root=n,i(l,r))},removeChildFromContainer:(n,r)=>{r&&g(n.getState().scene,r)},insertInContainerBefore:(n,r,l)=>{if(!r||!l)return;const f=n.getState().scene;f.__r3f&&c(f,r,l)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,l,f){if(n.__r3f.primitive&&f.object&&f.object!==n)return[!0];{const{args:p=[],children:_,...h}=f,{args:s=[],children:u,...b}=l;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((E,R)=>E!==s[R]))return[!0];const w=$e(n,h,b,!0);return w.changes.length?[!1,w]:null}},commitUpdate(n,[r,l],f,p,_,h){r?v(n,f,_,h):he(n,l)},commitMount(n,r,l,f){var p;const _=(p=n.__r3f)!=null?p:{};n.raycast&&_.handlers&&_.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>$(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:l,parent:f}=(r=n.__r3f)!=null?r:{};l&&f&&Le(f,n,l),n.isObject3D&&(n.visible=!1),Z(n)},unhideInstance(n,r){var l;const{attach:f,parent:p}=(l=n.__r3f)!=null?l:{};f&&p&&me(p,n,f),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),Z(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():X.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:he}}var xe,Re;const Be=()=>{var e;return(e=Me.ColorManagement)!=null?e:null},qe=e=>e&&e.isOrthographicCamera,Nt=e=>e&&e.hasOwnProperty("current"),ne=typeof window<"u"&&((xe=window.document)!=null&&xe.createElement||((Re=window.navigator)==null?void 0:Re.product)==="ReactNative")?P.useLayoutEffect:P.useEffect;function We(e){const t=P.useRef(e);return ne(()=>void(t.current=e),[e]),t}function Ht({set:e}){return ne(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ue extends P.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Ue.getDerivedStateFromError=()=>({error:!0});const Ge="__default",Te=new Map,Bt=e=>e&&!!e.memoized&&!!e.changes;function Ve(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const J=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e))return e===t;const d=D.obj(e);if(d&&i==="reference")return e===t;const g=D.arr(e);if(g&&o==="reference")return e===t;if((g||d)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(d&&o==="shallow"&&i==="shallow"){for(v in c?t:e)if(!D.equ(e[v],t[v],{strict:c,objects:"reference"}))return!1}else for(v in c?t:e)if(e[v]!==t[v])return!1;if(D.und(v)){if(g&&e.length===0&&t.length===0||d&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function qt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function Wt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function $(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Pe(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),c=i.pop();return o=i.reduce((d,g)=>d[g],e),{target:o,key:c}}else return{target:o,key:t}}const je=/-\d+$/;function me(e,t,o){if(D.str(o)){if(je.test(o)){const d=o.replace(je,""),{target:g,key:v}=Pe(e,d);Array.isArray(g[v])||(g[v]=[])}const{target:i,key:c}=Pe(e,o);t.__r3f.previousAttach=i[c],i[c]=t}else t.__r3f.previousAttach=o(e,t)}function Le(e,t,o){var i,c;if(D.str(o)){const{target:d,key:g}=Pe(e,o),v=t.__r3f.previousAttach;v===void 0?delete d[g]:d[g]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function $e(e,{children:t,key:o,ref:i,...c},{children:d,key:g,ref:v,...a}={},m=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},l=Object.entries(c),f=[];if(m){const _=Object.keys(a);for(let h=0;h<_.length;h++)c.hasOwnProperty(_[h])||l.unshift([_[h],Ge+"remove"])}l.forEach(([_,h])=>{var s;if((s=e.__r3f)!=null&&s.primitive&&_==="object"||D.equ(h,a[_]))return;if(/^on(LostPointer|Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return f.push([_,h,!0,[]]);let u=[];_.includes("-")&&(u=_.split("-")),f.push([_,h,!1,u]);for(const b in c){const w=c[b];b.startsWith(`${_}-`)&&f.push([b,w,!1,b.split("-")])}});const p={...c};return r.memoizedProps&&r.memoizedProps.args&&(p.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(p.attach=r.memoizedProps.attach),{memoized:p,changes:f}}function he(e,t){var o,i,c;const d=(o=e.__r3f)!=null?o:{},g=d.root,v=(i=g==null||g.getState==null?void 0:g.getState())!=null?i:{},{memoized:a,changes:m}=Bt(t)?t:$e(e,t),n=d.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let l=0;l<m.length;l++){let[f,p,_,h]=m[l],s=e,u=s[f];if(h.length&&(u=h.reduce((b,w)=>b[w],e),!(u&&u.set))){const[b,...w]=h.reverse();s=w.reverse().reduce((E,R)=>E[R],e),f=b}if(p===Ge+"remove")if(s.constructor){let b=Te.get(s.constructor);b||(b=new s.constructor,Te.set(s.constructor,b)),p=b[f]}else p=0;if(_)p?d.handlers[f]=p:delete d.handlers[f],d.eventCount=Object.keys(d.handlers).length;else if(u&&u.set&&(u.copy||u instanceof de)){if(Array.isArray(p))u.fromArray?u.fromArray(p):u.set(...p);else if(u.copy&&p&&p.constructor&&u.constructor===p.constructor)u.copy(p);else if(p!==void 0){const b=u instanceof Fe;!b&&u.setScalar?u.setScalar(p):u instanceof de&&p instanceof de?u.mask=p.mask:u.set(p),!Be()&&!v.linear&&b&&u.convertSRGBToLinear()}}else s[f]=p,!v.linear&&s[f]instanceof nt&&s[f].format===rt&&s[f].type===ot&&(s[f].encoding=Ie);Z(e)}if(d.parent&&v.internal&&e.raycast&&n!==d.eventCount){const l=v.internal.interaction.indexOf(e);l>-1&&v.internal.interaction.splice(l,1),d.eventCount&&v.internal.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(c=e.__r3f)!=null&&c.parent&&Ce(e),e}function Z(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function Ce(e){e.onUpdate==null||e.onUpdate(e)}function Ut(e,t){e.manual||(qe(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ae(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Gt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return X.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return X.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return X.ContinuousEventPriority;default:return X.DefaultEventPriority}}function Ze(e,t,o,i){const c=o.get(t);c&&(o.delete(t),o.size===0&&(e.delete(i),c.target.releasePointerCapture(i)))}function Vt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,c)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(c)}),o.capturedMap.forEach((i,c)=>{Ze(o.capturedMap,t,i,c)})}function $t(e){function t(a){const{internal:m}=e.getState(),n=a.offsetX-m.initialClick[0],r=a.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(a){return a.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(a,m){const n=e.getState(),r=new Set,l=[],f=m?m(n.internal.interaction):n.internal.interaction;for(let s=0;s<f.length;s++){const u=J(f[s]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function p(s){const u=J(s);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var b;u.events.compute==null||u.events.compute(a,u,(b=u.previousRoot)==null?void 0:b.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(s,!0):[]}let _=f.flatMap(p).sort((s,u)=>{const b=J(s.object),w=J(u.object);return!b||!w?s.distance-u.distance:w.events.priority-b.events.priority||s.distance-u.distance}).filter(s=>{const u=ae(s);return r.has(u)?!1:(r.add(u),!0)});n.events.filter&&(_=n.events.filter(_,n));for(const s of _){let u=s.object;for(;u;){var h;(h=u.__r3f)!=null&&h.eventCount&&l.push({...s,eventObject:u}),u=u.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let s of n.internal.capturedMap.get(a.pointerId).values())r.has(ae(s.intersection))||l.push(s.intersection);return l}function c(a,m,n,r){const l=e.getState();if(a.length){const f={stopped:!1};for(const p of a){const _=J(p.object)||l,{raycaster:h,pointer:s,camera:u,internal:b}=_,w=new G(s.x,s.y,0).unproject(u),E=A=>{var C,j;return(C=(j=b.capturedMap.get(A))==null?void 0:j.has(p.eventObject))!=null?C:!1},R=A=>{const C={intersection:p,target:m.target};b.capturedMap.has(A)?b.capturedMap.get(A).set(p.eventObject,C):b.capturedMap.set(A,new Map([[p.eventObject,C]])),m.target.setPointerCapture(A)},x=A=>{const C=b.capturedMap.get(A);C&&Ze(b.capturedMap,p.eventObject,C,A)};let T={};for(let A in m){let C=m[A];typeof C!="function"&&(T[A]=C)}let L={...p,...T,pointer:s,intersections:a,stopped:f.stopped,delta:n,unprojectedPoint:w,ray:h.ray,camera:u,stopPropagation(){const A="pointerId"in m&&b.capturedMap.get(m.pointerId);if((!A||A.has(p.eventObject))&&(L.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(C=>C.eventObject===p.eventObject))){const C=a.slice(0,a.indexOf(p));d([...C,p])}},target:{hasPointerCapture:E,setPointerCapture:R,releasePointerCapture:x},currentTarget:{hasPointerCapture:E,setPointerCapture:R,releasePointerCapture:x},nativeEvent:m};if(r(L),f.stopped===!0)break}}return a}function d(a){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!a.length||!a.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const l=n.eventObject.__r3f,f=l==null?void 0:l.handlers;if(m.hovered.delete(ae(n)),l!=null&&l.eventCount){const p={...n,intersections:a};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function g(a,m){for(let n=0;n<m.length;n++){const r=m[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(a)}}function v(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>d([])}return function(n){const{onPointerMissed:r,internal:l}=e.getState();l.lastEvent.current=n;const f=a==="onPointerMove",p=a==="onLostPointerCapture",_=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",s=i(n,f?o:void 0),u=_?t(n):0;a==="onPointerDown"&&(l.initialClick=[n.offsetX,n.offsetY],l.initialHits=s.map(w=>w.eventObject)),_&&!s.length&&u<=2&&(g(n,l.interaction),r&&r(n)),f&&d(s);function b(w){const E=w.eventObject,R=E.__r3f,x=R==null?void 0:R.handlers;if(R!=null&&R.eventCount)if(f){if(x.onPointerOver||x.onPointerEnter||x.onPointerOut||x.onPointerLeave){const T=ae(w),L=l.hovered.get(T);L?L.stopped&&w.stopPropagation():(l.hovered.set(T,w),x.onPointerOver==null||x.onPointerOver(w),x.onPointerEnter==null||x.onPointerEnter(w))}x.onPointerMove==null||x.onPointerMove(w)}else if(p){const{internal:T}=e.getState();"pointerId"in n&&T.capturedMap.has(n.pointerId)&&requestAnimationFrame(()=>{T.capturedMap.has(n.pointerId)&&(T.capturedMap.delete(n.pointerId),d([]),x.onLostPointerCapture==null||x.onLostPointerCapture(w))})}else{const T=x[a];T?(!_||l.initialHits.includes(E))&&(g(n,l.interaction.filter(L=>!l.initialHits.includes(L))),T(w)):_&&l.initialHits.includes(E)&&g(n,l.interaction.filter(L=>!l.initialHits.includes(L)))}}c(s,n,u,b)}}return{handlePointer:v}}const Xe=e=>!!(e!=null&&e.render),Ye=P.createContext(null),Zt=(e,t)=>{const o=Ne((v,a)=>{const m=new G,n=new G,r=new G;function l(s=a().camera,u=n,b=a().size){const{width:w,height:E,top:R,left:x}=b,T=w/E;u instanceof G?r.copy(u):r.set(...u);const L=s.getWorldPosition(m).distanceTo(r);if(qe(s))return{width:w/s.zoom,height:E/s.zoom,top:R,left:x,factor:1,distance:L,aspect:T};{const A=s.fov*Math.PI/180,C=2*Math.tan(A/2)*L,j=C*(w/E);return{width:j,height:C,top:R,left:x,factor:w/j,distance:L,aspect:T}}}let f;const p=s=>v(u=>({performance:{...u.performance,current:s}})),_=new ze;return{set:v,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(a(),s),advance:(s,u)=>t(s,u,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new yt,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=a();f&&clearTimeout(f),s.performance.current!==s.performance.min&&p(s.performance.min),f=setTimeout(()=>p(a().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:s=>v(u=>({...u,events:{...u.events,...s}})),setSize:(s,u,b,w,E)=>{const R=a().camera,x={width:s,height:u,top:w||0,left:E||0,updateStyle:b};v(T=>({size:x,viewport:{...T.viewport,...l(R,n,x)}}))},setDpr:s=>v(u=>{const b=Ve(s);return{viewport:{...u.viewport,dpr:b,initialDpr:u.viewport.initialDpr||b}}}),setFrameloop:(s="always")=>{const u=a().clock;u.stop(),u.elapsedTime=0,s!=="never"&&(u.start(),u.elapsedTime=0),v(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:P.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,u,b)=>{const w=a().internal;return w.priority=w.priority+(u>0?1:0),w.subscribers.push({ref:s,priority:u,store:b}),w.subscribers=w.subscribers.sort((E,R)=>E.priority-R.priority),()=>{const E=a().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(u>0?1:0),E.subscribers=E.subscribers.filter(R=>R.ref!==s))}}}}}),i=o.getState();let c=i.size,d=i.viewport.dpr,g=i.camera;return o.subscribe(()=>{const{camera:v,size:a,viewport:m,gl:n,set:r}=o.getState();if(a!==c||m.dpr!==d){var l;c=a,d=m.dpr,Ut(v,a),n.setPixelRatio(m.dpr);const f=(l=a.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,f)}v!==g&&(g=v,r(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(v)}})))}),o.subscribe(v=>e(v)),o};let se,Xt=new Set,Yt=new Set,Kt=new Set;function ge(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function Q(e,t){switch(e){case"before":return ge(Xt,t);case"after":return ge(Yt,t);case"tail":return ge(Kt,t)}}let ye,we;function _e(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ye=t.internal.subscribers,se=0;se<ye.length;se++)we=ye[se],we.ref.current(we.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Jt(e){let t=!1,o,i,c;function d(a){i=requestAnimationFrame(d),t=!0,o=0,Q("before",a);for(const n of e.values()){var m;c=n.store.getState(),c.internal.active&&(c.frameloop==="always"||c.internal.frames>0)&&!((m=c.gl.xr)!=null&&m.isPresenting)&&(o+=_e(a,c))}if(Q("after",a),o===0)return Q("tail",a),t=!1,cancelAnimationFrame(i)}function g(a,m=1){var n;if(!a)return e.forEach(r=>g(r.store.getState()),m);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+m),t||(t=!0,requestAnimationFrame(d)))}function v(a,m=!0,n,r){if(m&&Q("before",a),n)_e(a,n,r);else for(const l of e.values())_e(a,l.store.getState());m&&Q("after",a)}return{loop:d,invalidate:g,advance:v}}function Ke(){const e=P.useContext(Ye);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function N(e=o=>o,t){return Ke()(e,t)}function Se(e,t=0){const o=Ke(),i=o.getState().internal.subscribe,c=We(e);return ne(()=>i(c,t,o),[t,i,o]),null}function Je(e,t){return function(o,...i){const c=new o;return e&&e(c),Promise.all(i.map(d=>new Promise((g,v)=>c.load(d,a=>{a.scene&&Object.assign(a,qt(a.scene)),g(a)},t,a=>v(new Error(`Could not load ${d}: ${a.message})`))))))}}function re(e,t,o,i){const c=Array.isArray(t)?t:[t],d=Lt(Je(o,i),[e,...c],{equal:D.equ});return Array.isArray(t)?d:d[0]}re.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return At(Je(o),[e,...i])};re.clear=function(e,t){const o=Array.isArray(t)?t:[t];return Dt([e,...o])};const Y=new Map,{invalidate:Ae,advance:De}=Jt(Y),{reconciler:ue,applyProps:ee}=zt(Y,Gt),V={objects:"shallow",strict:!1},Qt=(e,t)=>{const o=typeof e=="function"?e(t):e;return Xe(o)?o:new ut({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function en(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:i,top:c,left:d}=e.parentElement.getBoundingClientRect();return{width:o,height:i,top:c,left:d}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function tn(e){const t=Y.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,d=i||Zt(Ae,De),g=o||ue.createContainer(d,X.ConcurrentRoot,null,!1,null,"",c,null);t||Y.set(e,{fiber:g,store:d});let v,a=!1,m;return{configure(n={}){let{gl:r,size:l,scene:f,events:p,onCreated:_,shadows:h=!1,linear:s=!1,flat:u=!1,legacy:b=!1,orthographic:w=!1,frameloop:E="always",dpr:R=[1,2],performance:x,raycaster:T,camera:L,onPointerMissed:A}=n,C=d.getState(),j=C.gl;C.gl||C.set({gl:j=Qt(r,e)});let F=C.raycaster;F||C.set({raycaster:F=new st});const{params:W,...U}=T||{};if(D.equ(U,F,V)||ee(F,{...U}),D.equ(W,F.params,V)||ee(F,{params:{...F.params,...W}}),!C.camera||C.camera===m&&!D.equ(m,L,V)){m=L;const O=L instanceof ft,k=O?L:w?new lt(0,0,0,0,.1,1e3):new ct(75,0,.1,1e3);O||(k.position.z=5,L&&ee(k,L),!C.camera&&!(L!=null&&L.rotation)&&k.lookAt(0,0,0)),C.set({camera:k})}if(!C.scene){let O;f instanceof Oe?O=f:(O=new Oe,f&&ee(O,f)),C.set({scene:$(O)})}if(!C.xr){const O=(I,K)=>{const B=d.getState();B.frameloop!=="never"&&De(I,!0,B,K)},k=()=>{const I=d.getState();I.gl.xr.enabled=I.gl.xr.isPresenting,I.gl.xr.setAnimationLoop(I.gl.xr.isPresenting?O:null),I.gl.xr.isPresenting||Ae(I)},H={connect(){const I=d.getState().gl;I.xr.addEventListener("sessionstart",k),I.xr.addEventListener("sessionend",k)},disconnect(){const I=d.getState().gl;I.xr.removeEventListener("sessionstart",k),I.xr.removeEventListener("sessionend",k)}};j.xr&&H.connect(),C.set({xr:H})}if(j.shadowMap){const O=j.shadowMap.enabled,k=j.shadowMap.type;if(j.shadowMap.enabled=!!h,D.boo(h))j.shadowMap.type=pe;else if(D.str(h)){var q;const H={basic:dt,percentage:pt,soft:pe,variance:vt};j.shadowMap.type=(q=H[h])!=null?q:pe}else D.obj(h)&&Object.assign(j.shadowMap,h);(O!==j.shadowMap.enabled||k!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const z=Be();z&&("enabled"in z?z.enabled=!b:"legacyMode"in z&&(z.legacyMode=b));const y=s?mt:Ie,S=u?ht:gt;j.outputEncoding!==y&&(j.outputEncoding=y),j.toneMapping!==S&&(j.toneMapping=S),C.legacy!==b&&C.set(()=>({legacy:b})),C.linear!==s&&C.set(()=>({linear:s})),C.flat!==u&&C.set(()=>({flat:u})),r&&!D.fun(r)&&!Xe(r)&&!D.equ(r,j,V)&&ee(j,r),p&&!C.events.handlers&&C.set({events:p(d)});const M=en(e,l);return D.equ(M,C.size,V)||C.setSize(M.width,M.height,M.updateStyle,M.top,M.left),R&&C.viewport.dpr!==Ve(R)&&C.setDpr(R),C.frameloop!==E&&C.setFrameloop(E),C.onPointerMissed||C.set({onPointerMissed:A}),x&&!D.equ(x,C.performance,V)&&C.set(O=>({performance:{...O.performance,...x}})),v=_,a=!0,this},render(n){return a||this.configure(),ue.updateContainer(P.createElement(nn,{store:d,children:n,onCreated:v,rootElement:e}),g,null,()=>{}),d},unmount(){Qe(e)}}}function nn({store:e,children:t,onCreated:o,rootElement:i}){return ne(()=>{const c=e.getState();c.set(d=>({internal:{...d.internal,active:!0}})),o&&o(c),e.getState().events.connected||c.events.connect==null||c.events.connect(i)},[]),P.createElement(Ye.Provider,{value:e},t)}function Qe(e,t){const o=Y.get(e),i=o==null?void 0:o.fiber;if(i){const c=o==null?void 0:o.store.getState();c&&(c.internal.active=!1),ue.updateContainer(null,i,null,()=>{c&&setTimeout(()=>{try{var d,g,v,a;c.events.disconnect==null||c.events.disconnect(),(d=c.gl)==null||(g=d.renderLists)==null||g.dispose==null||g.dispose(),(v=c.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(a=c.gl)!=null&&a.xr&&c.xr.disconnect(),Wt(c),Y.delete(e),t&&t(e)}catch{}},500)})}}ue.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:P.version});const be={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function rn(e){const{handlePointer:t}=$t(e);return{priority:1,enabled:!0,compute(o,i,c){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(be).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:c}=e.getState();(o=c.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(c.lastEvent.current)},connect:o=>{var i;const{set:c,events:d}=e.getState();d.disconnect==null||d.disconnect(),c(g=>({events:{...g.events,connected:o}})),Object.entries((i=d.handlers)!=null?i:[]).forEach(([g,v])=>{const[a,m]=be[g];o.addEventListener(a,v,{passive:m})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var c;Object.entries((c=i.handlers)!=null?c:[]).forEach(([d,g])=>{if(i&&i.connected instanceof HTMLElement){const[v]=be[d];i.connected.removeEventListener(v,g)}}),o(d=>({events:{...d.events,connected:void 0}}))}}}}const on=P.forwardRef(function({children:t,fallback:o,resize:i,style:c,gl:d,events:g=rn,eventSource:v,eventPrefix:a,shadows:m,linear:n,flat:r,legacy:l,orthographic:f,frameloop:p,dpr:_,performance:h,raycaster:s,camera:u,onPointerMissed:b,onCreated:w,...E},R){P.useMemo(()=>Ft(wt),[]);const x=kt(),[T,L]=St({scroll:!0,debounce:{scroll:50,resize:0},...i}),A=P.useRef(null),C=P.useRef(null);P.useImperativeHandle(R,()=>A.current);const j=We(b),[F,W]=P.useState(!1),[U,q]=P.useState(!1);if(F)throw F;if(U)throw U;const z=P.useRef(null);ne(()=>{const S=A.current;L.width>0&&L.height>0&&S&&(z.current||(z.current=tn(S)),z.current.configure({gl:d,events:g,shadows:m,linear:n,flat:r,legacy:l,orthographic:f,frameloop:p,dpr:_,performance:h,raycaster:s,camera:u,size:L,onPointerMissed:(...M)=>j.current==null?void 0:j.current(...M),onCreated:M=>{M.events.connect==null||M.events.connect(v?Nt(v)?v.current:v:C.current),a&&M.setEvents({compute:(O,k)=>{const H=O[a+"X"],I=O[a+"Y"];k.pointer.set(H/k.size.width*2-1,-(I/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),w==null||w(M)}}),z.current.render(P.createElement(x,null,P.createElement(Ue,{set:q},P.createElement(P.Suspense,{fallback:P.createElement(Ht,{set:W})},t)))))}),P.useEffect(()=>{const S=A.current;if(S)return()=>Qe(S)},[]);const y=v?"none":"auto";return P.createElement("div",fe({ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:y,...c}},E),P.createElement("div",{ref:T,style:{width:"100%",height:"100%"}},P.createElement("canvas",{ref:A,style:{display:"block"}},o)))}),wn=P.forwardRef(function(t,o){return P.createElement(Ot,null,P.createElement(on,fe({},t,{ref:o})))});let te=0;const _n=Ne(e=>(ie.onStart=(t,o,i)=>{e({active:!0,item:t,loaded:o,total:i,progress:(o-te)/(i-te)*100})},ie.onLoad=()=>{e({active:!1})},ie.onError=t=>e(o=>({errors:[...o.errors,t]})),ie.onProgress=(t,o,i)=>{o===i&&(te=i),e({active:!0,item:t,loaded:o,total:i,progress:(o-te)/(i-te)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));let le=null;function et(e,t,o){return i=>{o&&o(i),e&&(le||(le=new Rt),le.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(le)),t&&i.setMeshoptDecoder(typeof ve=="function"?ve():ve)}}function tt(e,t=!0,o=!0,i){return re(Ee,e,et(t,o,i))}tt.preload=(e,t=!0,o=!0,i)=>re.preload(Ee,e,et(t,o,i));tt.clear=e=>re.clear(Ee,e);const bn=P.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:c=!0,onChange:d,onStart:g,onEnd:v,...a},m)=>{const n=N(E=>E.invalidate),r=N(E=>E.camera),l=N(E=>E.gl),f=N(E=>E.events),p=N(E=>E.setEvents),_=N(E=>E.set),h=N(E=>E.get),s=N(E=>E.performance),u=t||r,b=i||f.connected||l.domElement,w=P.useMemo(()=>new Tt(u),[u]);return Se(()=>{w.enabled&&w.update()},-1),P.useEffect(()=>(w.connect(b),()=>void w.dispose()),[b,o,w,n]),P.useEffect(()=>{const E=T=>{n(),o&&s.regress(),d&&d(T)},R=T=>{g&&g(T)},x=T=>{v&&v(T)};return w.addEventListener("change",E),w.addEventListener("start",R),w.addEventListener("end",x),()=>{w.removeEventListener("start",R),w.removeEventListener("end",x),w.removeEventListener("change",E)}},[d,g,v,w,n,p]),P.useEffect(()=>{if(e){const E=h().controls;return _({controls:w}),()=>_({controls:E})}},[e,w]),P.createElement("primitive",fe({ref:m,object:w,enableDamping:c},a))});function Pn(e,t){const o=P.useRef(),[i]=P.useState(()=>t?t instanceof _t?{current:t}:t:o),[c]=P.useState(()=>new bt(void 0)),d=P.useRef({}),[g]=P.useState(()=>{const v={};return e.forEach(a=>Object.defineProperty(v,a.name,{enumerable:!0,get(){if(i.current)return d.current[a.name]||(d.current[a.name]=c.clipAction(a,i.current))}})),{ref:i,clips:e,actions:v,names:e.map(a=>a.name),mixer:c}});return Se((v,a)=>c.update(a)),P.useEffect(()=>{const v=i.current;return()=>{d.current={},Object.values(g.actions).forEach(a=>{v&&c.uncacheAction(a,v)})}},[e]),P.useEffect(()=>()=>{c.stopAllAction()},[c]),g}class an extends Pt{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new G(0,0,0)},lightColor:{value:new Fe("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new ze(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
      varying vec3 vNormal;
      varying vec3 vWorldPosition;
      varying float vViewZ;
      varying float vIntensity;
      uniform vec3 spotPosition;
      uniform float attenuation;      

      void main() {
        // compute intensity
        vNormal = normalize( normalMatrix * normal );
        vec4 worldPosition	= modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;
        vec4 viewPosition = viewMatrix * worldPosition;
        vViewZ = viewPosition.z;
        float intensity	= distance(worldPosition.xyz, spotPosition) / attenuation;
        intensity	= 1.0 - clamp(intensity, 0.0, 1.0);
        vIntensity = intensity;        
        // set gl_Position
        gl_Position	= projectionMatrix * viewPosition;

      }`,fragmentShader:`
      #include <packing>

      varying vec3 vNormal;
      varying vec3 vWorldPosition;
      uniform vec3 lightColor;
      uniform vec3 spotPosition;
      uniform float attenuation;
      uniform float anglePower;
      uniform sampler2D depth;
      uniform vec2 resolution;
      uniform float cameraNear;
      uniform float cameraFar;
      varying float vViewZ;
      varying float vIntensity;
      uniform float opacity;

      float readDepth( sampler2D depthSampler, vec2 coord ) {
        float fragCoordZ = texture2D( depthSampler, coord ).x;
        float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
        return viewZ;
      }

      void main() {
        float d = 1.0;
        bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
        if (isSoft) {
          vec2 sUv = gl_FragCoord.xy / resolution;
          d = readDepth(depth, sUv);
        }
        float intensity = vIntensity;
        vec3 normal	= vec3(vNormal.x, vNormal.y, abs(vNormal.z));
        float angleIntensity	= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );
        intensity	*= angleIntensity;
        // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
        if (isSoft) {
          intensity	*= smoothstep(0., 1., vViewZ - d);
        }
        gl_FragColor = vec4(lightColor, intensity * opacity);

        #include <tonemapping_fragment>
	      #include <encodings_fragment>
      }`})}}function sn({opacity:e=1,radiusTop:t,radiusBottom:o,depthBuffer:i,color:c="white",distance:d=5,angle:g=.15,attenuation:v=5,anglePower:a=5}){const m=P.useRef(null),n=N(h=>h.size),r=N(h=>h.camera),l=N(h=>h.viewport.dpr),[f]=P.useState(()=>new an),[p]=P.useState(()=>new G);t=t===void 0?.1:t,o=o===void 0?g*7:o,Se(()=>{f.uniforms.spotPosition.value.copy(m.current.getWorldPosition(p)),m.current.lookAt(m.current.parent.target.getWorldPosition(p))});const _=P.useMemo(()=>{const h=new Ct(t,o,d,128,64,!0);return h.applyMatrix4(new ke().makeTranslation(0,-d/2,0)),h.applyMatrix4(new ke().makeRotationX(-Math.PI/2)),h},[d,t,o]);return P.createElement(P.Fragment,null,P.createElement("mesh",{ref:m,geometry:_,raycast:()=>null},P.createElement("primitive",{object:f,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":c,"uniforms-attenuation-value":v,"uniforms-anglePower-value":a,"uniforms-depth-value":i,"uniforms-cameraNear-value":r.near,"uniforms-cameraFar-value":r.far,"uniforms-resolution-value":i?[n.width*l,n.height*l]:[0,0]})))}const Cn=P.forwardRef(({opacity:e=1,radiusTop:t,radiusBottom:o,depthBuffer:i,color:c="white",distance:d=5,angle:g=.15,attenuation:v=5,anglePower:a=5,volumetric:m=!0,debug:n=!1,children:r,...l},f)=>{const p=P.useRef(null);return P.createElement("group",null,n&&p.current&&P.createElement("spotLightHelper",{args:[p.current]}),P.createElement("spotLight",fe({ref:jt([f,p]),angle:g,color:c,distance:d,castShadow:!0},l),m&&P.createElement(sn,{debug:n,opacity:e,radiusTop:t,radiusBottom:o,depthBuffer:i,color:c,distance:d,angle:g,attenuation:v,anglePower:a})),r&&P.cloneElement(r,{spotlightRef:p,debug:n}))});function En({all:e,scene:t,camera:o}){const i=N(({gl:g})=>g),c=N(({camera:g})=>g),d=N(({scene:g})=>g);return P.useLayoutEffect(()=>{const g=[];e&&(t||d).traverse(m=>{m.visible===!1&&(g.push(m),m.visible=!0)}),i.compile(t||d,o||c);const v=new Et(128);new Mt(.01,1e5,v).update(i,t||d),v.dispose(),g.forEach(m=>m.visible=!1)},[]),null}export{wn as C,bn as O,En as P,Cn as S,tt as a,Pn as b,_n as u};
